-- // Midnight Chasers: Zuan WM Dock Ultimate Edition üßô‚Äç‚ôÇÔ∏è //
-- Features: Minimize, Close, Dock Hover, Touch Restore, Smart Ground Alignment
-- Optimized for Delta Mobile Executor

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- Global state
getgenv().AutoFarm = false
getgenv().AutoDeliver = false
getgenv().Speed = 250
getgenv().GroundPart = nil
getgenv().IsRunning = false
getgenv().Minimized = false
getgenv().Closed = false

-- Anti AFK
LocalPlayer.Idled:Connect(function()
    local vu = game:GetService("VirtualUser")
    vu:CaptureController()
    vu:ClickButton2(Vector2.new())
end)

-- Blur effect
local blur = Instance.new("BlurEffect", Lighting)
blur.Size = 0
blur.Enabled = false

-- Helpers
local function ensureGroundPart()
    if not getgenv().GroundPart then
        local ground = Instance.new("Part", workspace)
        ground.Anchored = true
        ground.Size = Vector3.new(10000, 10, 10000)
        ground.Position = Vector3.new(0, -50, 0)
        ground.Color = Color3.fromRGB(25, 25, 25)
        getgenv().GroundPart = ground
    end
end

local function findCar()
    local chr = LocalPlayer.Character
    if not chr or not chr:FindFirstChildOfClass("Humanoid") then return nil end
    local hum = chr:FindFirstChildOfClass("Humanoid")
    if hum and hum.SeatPart and hum.SeatPart.Parent then
        local car = hum.SeatPart.Parent
        if car:FindFirstChild("Body") and car.Body:FindFirstChild("#Weight") then
            car.PrimaryPart = car.Body["#Weight"]
            return car
        end
    end
    return nil
end

local function alignCarToGround(car)
    if not car or not car.PrimaryPart then return end
    local origin = car.PrimaryPart.Position
    local ray = Ray.new(origin, Vector3.new(0, -50, 0))
    local hit, pos = Workspace:FindPartOnRay(ray, car)
    if hit then
        local hover = 3
        car:PivotTo(CFrame.new(Vector3.new(pos.X, pos.Y + hover, pos.Z), car.PrimaryPart.CFrame.LookVector))
    end
end

local function tpBelowSurface(car)
    if car and car.PrimaryPart then
        car:PivotTo(car.PrimaryPart.CFrame - Vector3.new(0, 8, 0))
    end
end

local function tpAboveSurface(car)
    if car and car.PrimaryPart then
        alignCarToGround(car)
    end
end

-- Smooth Heartbeat Tween
local function smoothTween(car, targetPos, speed)
    if not car or not car.PrimaryPart then return end
    ensureGroundPart()
    local startPos = car.PrimaryPart.Position
    local dist = (startPos - targetPos.Position).Magnitude
    local duration = dist / speed
    local startTime = tick()

    while tick() - startTime < duration and getgenv().IsRunning do
        local dt = RunService.Heartbeat:Wait()
        local alpha = math.clamp((tick() - startTime) / duration, 0, 1)
        local eased = 0.5 - 0.5 * math.cos(math.pi * alpha)
        local newPos = startPos:Lerp(targetPos.Position, eased)
        getgenv().GroundPart.Position = newPos - Vector3.new(0, 14, 0)
        car:PivotTo(CFrame.new(getgenv().GroundPart.Position + Vector3.new(0, 7, 0), targetPos.Position))
        car.PrimaryPart.AssemblyLinearVelocity = car.PrimaryPart.CFrame.LookVector * speed
    end
    alignCarToGround(car)
end

-- AutoFarm Loop
local function autoFarmLoop()
    task.spawn(function()
        getgenv().IsRunning = true
        ensureGroundPart()
        local car = findCar()
        if not car then return end
        local frames = {
            CFrame.new(100, -25, 7960),
            CFrame.new(2750, -25, 3690),
            CFrame.new(-8800, -25, 2050),
            CFrame.new(-6400, -25, -720),
            CFrame.new(4900, -25, 1200)
        }
        while getgenv().AutoFarm and getgenv().IsRunning do
            for _, pos in ipairs(frames) do
                if not getgenv().AutoFarm then break end
                smoothTween(car, pos + Vector3.new(0, 5, 0), getgenv().Speed)
                task.wait(0.2)
            end
        end
        getgenv().IsRunning = false
    end)
end

-- AutoDeliver Loop
local function autoDeliverLoop()
    task.spawn(function()
        getgenv().IsRunning = true
        ensureGroundPart()
        while getgenv().AutoDeliver and getgenv().IsRunning do
            local plr = LocalPlayer
            local car = findCar()
            if not car then task.wait(1) continue end
            local nearest, dist = nil, math.huge
            for _, v in pairs(workspace:GetChildren()) do
                if v:FindFirstChild("Highlight") then
                    local d = (plr.Character.HumanoidRootPart.Position - v.WorldPivot.Position).Magnitude
                    if d < dist then
                        dist = d
                        nearest = v
                    end
                end
            end
            if nearest then
                tpBelowSurface(car)
                smoothTween(car, nearest.WorldPivot + Vector3.new(0, 5, 0), getgenv().Speed)
                tpAboveSurface(car)
            else
                task.wait(1)
            end
        end
        getgenv().IsRunning = false
    end)
end

-- GUI CREATION --
local parentGui = LocalPlayer:FindFirstChildOfClass("PlayerGui") or game:GetService("CoreGui")
local gui = Instance.new("ScreenGui", parentGui)
gui.Name = "ZuanDockUI"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 320, 0, 260)
frame.Position = UDim2.new(1, -340, 1, -280)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 50)
frame.BorderSizePixel = 0
frame.Active = true
frame.ZIndex = 10

local corner = Instance.new("UICorner", frame)
corner.CornerRadius = UDim.new(0, 14)

local gradient = Instance.new("UIGradient", frame)
gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(100, 0, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 255, 255))
})
gradient.Rotation = 45

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, -60, 0, 40)
title.Position = UDim2.new(0, 10, 0, 0)
title.BackgroundTransparency = 1
title.Text = "‚ö° Midnight Zuan Dock"
title.Font = Enum.Font.GothamBold
title.TextScaled = true
title.TextColor3 = Color3.fromRGB(200, 170, 255)

-- Minimize & Close buttons
local minBtn = Instance.new("TextButton", frame)
minBtn.Size = UDim2.new(0, 30, 0, 30)
minBtn.Position = UDim2.new(1, -60, 0, 5)
minBtn.Text = "‚Äì"
minBtn.Font = Enum.Font.GothamBold
minBtn.TextSize = 24
minBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minBtn.BackgroundTransparency = 0.8
minBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 120)
local c1 = Instance.new("UICorner", minBtn)

local closeBtn = Instance.new("TextButton", frame)
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -30, 0, 5)
closeBtn.Text = "X"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 20
closeBtn.TextColor3 = Color3.fromRGB(255, 200, 200)
closeBtn.BackgroundTransparency = 0.8
closeBtn.BackgroundColor3 = Color3.fromRGB(100, 50, 50)
local c2 = Instance.new("UICorner", closeBtn)

-- Content Frame
local content = Instance.new("Frame", frame)
content.Size = UDim2.new(1, 0, 1, -40)
content.Position = UDim2.new(0, 0, 0, 40)
content.BackgroundTransparency = 1

local scroll = Instance.new("ScrollingFrame", content)
scroll.Size = UDim2.new(1, 0, 1, 0)
scroll.CanvasSize = UDim2.new(0, 0, 2, 0)
scroll.ScrollBarThickness = 4
scroll.BackgroundTransparency = 1

local status = Instance.new("TextLabel", frame)
status.Size = UDim2.new(1, 0, 0, 20)
status.Position = UDim2.new(0, 0, 1, -25)
status.BackgroundTransparency = 1
status.Text = "üî¥ Idle"
status.TextColor3 = Color3.fromRGB(255, 100, 100)
status.Font = Enum.Font.Gotham
status.TextSize = 14

-- Draggable with inertia
do
    local dragging, dragStart, startPos, velocity = false, nil, nil, Vector2.new(0, 0)
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement) then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            velocity = input.Delta
        end
    end)
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
            local decay = 0.9
            while math.abs(velocity.X) > 1 or math.abs(velocity.Y) > 1 do
                frame.Position = UDim2.new(frame.Position.X.Scale, frame.Position.X.Offset + velocity.X, frame.Position.Y.Scale, frame.Position.Y.Offset + velocity.Y)
                velocity *= decay
                RunService.Heartbeat:Wait()
            end
        end
    end)
end

-- Button factory
local function createButton(text, callback)
    local b = Instance.new("TextButton", scroll)
    b.Size = UDim2.new(1, -20, 0, 40)
    b.Position = UDim2.new(0, 10, 0, (#scroll:GetChildren() - 1) * 45)
    b.BackgroundColor3 = Color3.fromRGB(50, 50, 80)
    b.Text = text
    b.TextColor3 = Color3.new(1,1,1)
    b.Font = Enum.Font.Gotham
    b.TextSize = 18
    local c = Instance.new("UICorner", b)
    local active = false
    b.MouseButton1Click:Connect(function()
        active = not active
        b.BackgroundColor3 = active and Color3.fromRGB(100,0,200) or Color3.fromRGB(50,50,80)
        callback(active)
        if active then
            status.Text = "üü¢ Running: "..text
            status.TextColor3 = Color3.fromRGB(100,255,100)
        else
            status.Text = "üî¥ Stopped"
            status.TextColor3 = Color3.fromRGB(255,100,100)
        end
    end)
end

-- Buttons
createButton("Auto Farm", function(state)
    getgenv().AutoFarm = state
    if state then autoFarmLoop() else getgenv().IsRunning = false end
end)

createButton("Auto Deliver", function(state)
    getgenv().AutoDeliver = state
    if state then autoDeliverLoop() else getgenv().IsRunning = false end
end)

local speedBox = Instance.new("TextBox", scroll)
speedBox.Size = UDim2.new(1, -20, 0, 40)
speedBox.Position = UDim2.new(0, 10, 0, (#scroll:GetChildren() - 1) * 45)
speedBox.PlaceholderText = "Enter Speed"
speedBox.Text = tostring(getgenv().Speed)
speedBox.TextColor3 = Color3.new(1,1,1)
speedBox.BackgroundColor3 = Color3.fromRGB(35,35,55)
speedBox.Font = Enum.Font.Gotham
speedBox.TextSize = 18
local c2 = Instance.new("UICorner", speedBox)

speedBox.FocusLost:Connect(function()
    local val = tonumber(speedBox.Text)
    if val then getgenv().Speed = val end
end)

-- Minimize behavior
minBtn.MouseButton1Click:Connect(function()
    if not getgenv().Minimized then
        getgenv().Minimized = true
        TweenService:Create(frame, TweenInfo.new(0.4, Enum.EasingStyle.Sine), {Size = UDim2.new(0, 80, 0, 80), Transparency = 0.4}):Play()
        for _, child in pairs(frame:GetChildren()) do
            if child ~= minBtn and child ~= closeBtn then child.Visible = false end
        end
        minBtn.Text = "+"
    else
        getgenv().Minimized = false
        TweenService:Create(frame, TweenInfo.new(0.4, Enum.EasingStyle.Sine), {Size = UDim2.new(0, 320, 0, 260), Transparency = 0}):Play()
        for _, child in pairs(frame:GetChildren()) do
            if child ~= minBtn and child ~= closeBtn then child.Visible = true end
        end
        minBtn.Text = "‚Äì"
    end
end)

-- Close behavior
closeBtn.MouseButton1Click:Connect(function()
    getgenv().Closed = true
    TweenService:Create(frame, TweenInfo.new(0.4, Enum.EasingStyle.Sine), {Transparency = 1}):Play()
    task.wait(0.5)
    frame.Visible = false
end)

-- Touch reopen
local dockIcon = Instance.new("ImageButton", gui)
dockIcon.Size = UDim2.new(0, 60, 0, 60)
dockIcon.Position = UDim2.new(1, -70, 1, -70)
dockIcon.Image = "rbxassetid://7072724538"
dockIcon.BackgroundTransparency = 1
dockIcon.Visible = false

dockIcon.MouseButton1Click:Connect(function()
    frame.Visible = true
    TweenService:Create(frame, TweenInfo.new(0.4, Enum.EasingStyle.Sine), {Transparency = 0}):Play()
    getgenv().Closed = false
    dockIcon.Visible = false
end)

closeBtn.MouseButton1Click:Connect(function()
    getgenv().Closed = true
    frame.Visible = false
    dockIcon.Visible = true
end)

-- Blur toggle
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.RightShift then
        gui.Enabled = not gui.Enabled
        blur.Enabled = gui.Enabled
        local t = 0
        while t < 1 do
            t += RunService.Heartbeat:Wait() * 2
            blur.Size = gui.Enabled and (t * 20) or ((1 - t) * 20)
        end
    end
end)

warn("üåå Zuan WM Dock Ultimate Edition Loaded Successfully!")

