--// MIDNIGHT CHASERS AUTO FARM - DELTA EXECUTOR OPTIMIZED //--

local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local VirtualUser = game:GetService("VirtualUser")

local plr = Players.LocalPlayer
local mouse = plr:GetMouse()

local scriptState = {
	speed = 230,
	autoFarm = false,
	autoDeliver = false,
	backupFolder = nil,
	groundPart = nil,
	activeTween = nil,
	tweenCancelFlag = false
}

--// ANTI-AFK //--
task.spawn(function()
	warn("Anti AFK initialized")
	plr.Idled:Connect(function()
		warn("Anti AFK activated")
		VirtualUser:CaptureController()
		VirtualUser:ClickButton2(Vector2.new())
	end)
end)

--// STREAM LOADING //--
task.spawn(function()
	for i, v in pairs(workspace:GetDescendants()) do
		if v:IsA("Model") then
			task.spawn(function()
				pcall(function()
					plr:RequestStreamAroundAsync(v.WorldPivot.Position, 3)
				end)
			end)
		end
		task.wait(0.01)
	end
end)

--// UTILITY FUNCTIONS //--
local function createBackupFolder()
	if not scriptState.backupFolder then
		scriptState.backupFolder = Instance.new("Folder")
		scriptState.backupFolder.Name = "mrbackupfolder"
		scriptState.backupFolder.Parent = game.ReplicatedStorage
	end
	return scriptState.backupFolder
end

local function hideWorkspaceObjects()
	local backup = createBackupFolder()
	for i, v in pairs(workspace:GetChildren()) do
		local shouldHide = false
		if v:IsA("Model") or v:IsA("Folder") then
			if not string.find(v.Name, plr.Name) and not string.find(v.Name, plr.DisplayName) and 
			   not string.find(v.Name, "Gift") and v.Name ~= "" and v.Name ~= "Baseplate" then
				shouldHide = true
			end
		elseif v:IsA("MeshPart") then
			shouldHide = true
		end
		
		if shouldHide then
			pcall(function()
				v.Parent = backup
			end)
		end
	end
end

local function restoreWorkspaceObjects()
	if scriptState.backupFolder and scriptState.backupFolder.Parent then
		for i, v in pairs(scriptState.backupFolder:GetChildren()) do
			pcall(function()
				v.Parent = workspace
			end)
			task.wait(0.05)
		end
	end
end

local function ensureGroundPart()
	if not scriptState.groundPart or not scriptState.groundPart.Parent then
		scriptState.groundPart = Instance.new("Part")
		scriptState.groundPart.Anchored = true
		scriptState.groundPart.CanCollide = true
		scriptState.groundPart.Size = Vector3.new(10000, 10, 10000)
		scriptState.groundPart.TopSurface = Enum.SurfaceType.Smooth
		scriptState.groundPart.BottomSurface = Enum.SurfaceType.Smooth
		scriptState.groundPart.Transparency = 1
		scriptState.groundPart.CFrame = CFrame.new(0, -50, 0)
		scriptState.groundPart.Parent = workspace
	end
end

local function reachedMax(car)
	local seatCount = 0
	for i, v in pairs(car:GetDescendants()) do
		if v:IsA("Seat") then
			seatCount = seatCount + 1
		end
	end
	local maxGifts = seatCount * 5
	if car:FindFirstChild("Gifts") then
		return #car.Gifts:GetChildren() == maxGifts
	end
	return false
end

--// TWEEN FUNCTIONS //--
local function tweenToPosition(car, targetCFrame, travelSpeed)
	if not car or not car.Parent or not scriptState.groundPart then return end
	
	local startPos = car:GetPrimaryPartCFrame().Position
	local endPos = targetCFrame.Position
	local dist = (startPos - endPos).Magnitude
	
	if dist < 5 then return end
	
	local tweenDuration = dist / travelSpeed
	local tweenInfo = TweenInfo.new(tweenDuration, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut)
	
	local cframeValue = Instance.new("CFrameValue")
	cframeValue.Value = car:GetPrimaryPartCFrame()
	
	local connection
	connection = cframeValue.Changed:Connect(function()
		if scriptState.autoFarm and car and car.Parent then
			local currentPos = cframeValue.Value.Position
			scriptState.groundPart.Position = currentPos - Vector3.new(0, 14, 0)
			car:PivotTo(CFrame.new(scriptState.groundPart.Position + Vector3.new(0, 7, 0), endPos))
			
			local velocity = car.PrimaryPart.CFrame.LookVector * travelSpeed
			car.PrimaryPart.AssemblyLinearVelocity = velocity
		end
	end)
	
	scriptState.activeTween = TweenService:Create(cframeValue, tweenInfo, {Value = targetCFrame})
	scriptState.activeTween:Play()
	
	scriptState.activeTween.Completed:Connect(function()
		connection:Disconnect()
		cframeValue:Destroy()
	end)
end

local function tweenToLocation(car, targetModel, travelSpeed)
	if not car or not car.Parent or not targetModel or not targetModel.Parent then return end
	
	local targetPos = targetModel.WorldPivot.Position + Vector3.new(0, 5, 0)
	local startPos = car:GetPrimaryPartCFrame().Position
	local dist = (startPos - targetPos).Magnitude
	
	if dist < 5 then return end
	
	local tweenDuration = dist / travelSpeed
	local tweenInfo = TweenInfo.new(tweenDuration, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut)
	
	local cframeValue = Instance.new("CFrameValue")
	cframeValue.Value = car:GetPrimaryPartCFrame()
	
	local connection
	connection = cframeValue.Changed:Connect(function()
		if scriptState.autoDeliver and car and car.Parent and targetModel.Parent then
			local currentPos = cframeValue.Value.Position
			local distToTarget = (plr.Character.PrimaryPart.Position - targetPos).Magnitude
			
			scriptState.groundPart.Position = currentPos - Vector3.new(0, 14, 0)
			
			if distToTarget > 100 then
				car:PivotTo(CFrame.new(scriptState.groundPart.Position + Vector3.new(0, 7, 0), targetPos))
				local velocity = car.PrimaryPart.CFrame.LookVector * travelSpeed
				car.PrimaryPart.AssemblyLinearVelocity = velocity
			elseif distToTarget < 100 and distToTarget > 10 then
				local velocity = car.PrimaryPart.CFrame.LookVector * 20
				scriptState.groundPart.Position = currentPos - Vector3.new(0, 8, 0)
				car:PivotTo(CFrame.new(scriptState.groundPart.Position + Vector3.new(0, 7, 0), Vector3.new(targetPos.X, car.PrimaryPart.CFrame.Y, targetPos.Z)))
				car.PrimaryPart.AssemblyLinearVelocity = velocity
			elseif distToTarget < 5 then
				car:PivotTo(CFrame.new(Vector3.new(targetPos.X, scriptState.groundPart.CFrame.Y + 7, targetPos.Z)))
				car.PrimaryPart.AssemblyLinearVelocity = Vector3.zero
			end
		end
	end)
	
	scriptState.activeTween = TweenService:Create(cframeValue, tweenInfo, {Value = targetPos})
	scriptState.activeTween:Play()
	
	scriptState.activeTween.Completed:Connect(function()
		connection:Disconnect()
		cframeValue:Destroy()
	end)
end

--// GUI CREATION //--
local gui = Instance.new("ScreenGui")
gui.Name = "MidnightChasersGUI"
gui.ResetOnSpawn = false
gui.Parent = plr:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 300, 0, 220)
mainFrame.Position = UDim2.new(0, 20, 0, 20)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = gui

-- Dragging
local dragging = false
local dragOffset = Vector2.new()
mainFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragOffset = mouse.Position - mainFrame.AbsolutePosition
	end
end)

mainFrame.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = false
	end
end)

mouse.Move:Connect(function()
	if dragging then
		mainFrame.Position = UDim2.new(0, mouse.Position.X - dragOffset.X, 0, mouse.Position.Y - dragOffset.Y)
	end
end)

-- Title Bar
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local titleText = Instance.new("TextLabel")
titleText.Size = UDim2.new(1, -70, 1, 0)
titleText.BackgroundTransparency = 1
titleText.TextColor3 = Color3.fromRGB(255, 255, 255)
titleText.TextSize = 14
titleText.TextXAlignment = Enum.TextXAlignment.Left
titleText.Text = "  Midnight Chasers Farm"
titleText.Font = Enum.Font.GothamBold
titleText.Parent = titleBar

-- Minimize Button
local minBtn = Instance.new("TextButton")
minBtn.Name = "MinimizeBtn"
minBtn.Size = UDim2.new(0, 30, 1, 0)
minBtn.Position = UDim2.new(1, -65, 0, 0)
minBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
minBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minBtn.TextSize = 18
minBtn.Text = "−"
minBtn.Font = Enum.Font.GothamBold
minBtn.BorderSizePixel = 0
minBtn.Parent = titleBar

-- Close Button
local closeBtn = Instance.new("TextButton")
closeBtn.Name = "CloseBtn"
closeBtn.Size = UDim2.new(0, 30, 1, 0)
closeBtn.Position = UDim2.new(1, -35, 0, 0)
closeBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.TextSize = 18
closeBtn.Text = "×"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.BorderSizePixel = 0
closeBtn.Parent = titleBar

-- Content Container
local contentFrame = Instance.new("Frame")
contentFrame.Name = "Content"
contentFrame.Size = UDim2.new(1, 0, 1, -30)
contentFrame.Position = UDim2.new(0, 0, 0, 30)
contentFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
contentFrame.BorderSizePixel = 0
contentFrame.Parent = mainFrame

local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 6)
uiCorner.Parent = mainFrame

local padding = Instance.new("UIPadding")
padding.PaddingLeft = UDim.new(0, 10)
padding.PaddingRight = UDim.new(0, 10)
padding.PaddingTop = UDim.new(0, 10)
padding.PaddingBottom = UDim.new(0, 10)
padding.Parent = contentFrame

local uiListLayout = Instance.new("UIListLayout")
uiListLayout.Padding = UDim.new(0, 8)
uiListLayout.Parent = contentFrame

-- Speed Input
local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(1, 0, 0, 20)
speedLabel.BackgroundTransparency = 1
speedLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
speedLabel.TextSize = 12
speedLabel.Text = "Speed:"
speedLabel.TextXAlignment = Enum.TextXAlignment.Left
speedLabel.Font = Enum.Font.Gotham
speedLabel.Parent = contentFrame

local speedInput = Instance.new("TextBox")
speedInput.Size = UDim2.new(1, 0, 0, 25)
speedInput.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
speedInput.TextColor3 = Color3.fromRGB(255, 255, 255)
speedInput.TextSize = 12
speedInput.Text = "230"
speedInput.PlaceholderText = "Enter speed"
speedInput.BorderSizePixel = 0
speedInput.Font = Enum.Font.Gotham
speedInput.Parent = contentFrame

local speedCorner = Instance.new("UICorner")
speedCorner.CornerRadius = UDim.new(0, 4)
speedCorner.Parent = speedInput

speedInput.FocusLost:Connect(function()
	local newSpeed = tonumber(speedInput.Text)
	if newSpeed and newSpeed > 0 then
		scriptState.speed = newSpeed
	else
		speedInput.Text = tostring(scriptState.speed)
	end
end)

-- Auto Farm Button
local autoFarmBtn = Instance.new("TextButton")
autoFarmBtn.Name = "AutoFarmBtn"
autoFarmBtn.Size = UDim2.new(1, 0, 0, 30)
autoFarmBtn.BackgroundColor3 = Color3.fromRGB(50, 120, 200)
autoFarmBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
autoFarmBtn.TextSize = 14
autoFarmBtn.Text = "Auto Farm [OFF]"
autoFarmBtn.Font = Enum.Font.GothamBold
autoFarmBtn.BorderSizePixel = 0
autoFarmBtn.Parent = contentFrame

local farmCorner = Instance.new("UICorner")
farmCorner.CornerRadius = UDim.new(0, 4)
farmCorner.Parent = autoFarmBtn

-- Auto Deliver Button
local autoDeliverBtn = Instance.new("TextButton")
autoDeliverBtn.Name = "AutoDeliverBtn"
autoDeliverBtn.Size = UDim2.new(1, 0, 0, 30)
autoDeliverBtn.BackgroundColor3 = Color3.fromRGB(50, 120, 200)
autoDeliverBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
autoDeliverBtn.TextSize = 14
autoDeliverBtn.Text = "Auto Deliver [OFF]"
autoDeliverBtn.Font = Enum.Font.GothamBold
autoDeliverBtn.BorderSizePixel = 0
autoDeliverBtn.Parent = contentFrame

local deliverCorner = Instance.new("UICorner")
deliverCorner.CornerRadius = UDim.new(0, 4)
deliverCorner.Parent = autoDeliverBtn

--// BUTTON EVENTS //--
autoFarmBtn.MouseButton1Click:Connect(function()
	scriptState.autoFarm = not scriptState.autoFarm
	autoFarmBtn.Text = scriptState.autoFarm and "Auto Farm [ON]" or "Auto Farm [OFF]"
	autoFarmBtn.BackgroundColor3 = scriptState.autoFarm and Color3.fromRGB(100, 200, 100) or Color3.fromRGB(50, 120, 200)
	
	if scriptState.autoFarm then
		hideWorkspaceObjects()
		task.wait(0.5)
		
		task.spawn(function()
			while scriptState.autoFarm do
				if not plr.Character or not plr.Character:FindFirstChild("Humanoid") then
					task.wait(1)
					continue
				end
				
				local chr = plr.Character
				local humanoid = chr:FindFirstChild("Humanoid")
				
				if not humanoid.SeatPart then
					task.wait(0.5)
					continue
				end
				
				local car = humanoid.SeatPart.Parent
				ensureGroundPart()
				
				if car:FindFirstChild("Body") and car.Body:FindFirstChild("#Weight") then
					car.PrimaryPart = car.Body["#Weight"]
				end
				
				local frames = {
					CFrame.new(105.419128, -26.0098934, 7965.37988, -3.36170197e-05, 0.951051414, -0.309032798, -1, -3.36170197e-05, 5.31971455e-06, -5.31971455e-06, 0.309032798, 0.951051414),
					CFrame.new(2751.86499, -26.0098934, 3694.63354, 3.34978104e-05, 0.951051414, -0.309032798, -1, 3.34978104e-05, -5.31971455e-06, 5.31971455e-06, 0.309032798, 0.951051414),
					CFrame.new(-8821.48438, -26.0098934, 2042.49939, -3.36170197e-05, 0.951051414, -0.309032798, -1, -3.36170197e-05, 5.31971455e-06, -5.31971455e-06, 0.309032798, 0.951051414),
					CFrame.new(-6408.62109, -26.0098934, -727.765198, 3.34978104e-05, 0.951051414, -0.309032798, -1, 3.34978104e-05, -5.31971455e-06, 5.31971455e-06, 0.309032798, 0.951051414),
					CFrame.new(-6099.79639, -26.00989345, -1027.94556, -3.36170197e-05, 0.951051414, -0.309032798, -1, -3.36170197e-05, 5.31971455e-06, -5.31971455e-06, 0.309032798, 0.951051414),
					CFrame.new(-6066.70068, -26.0098934, 493.255524, 3.34978104e-05, 0.951051414, -0.309032798, -1, 3.34978104e-05, -5.31971455e-06, 5.31971455e-06, 0.309032798, 0.951051414),
					CFrame.new(132.786133, -26.0098934, 15.2286377, 3.34978104e-05, 0.951051414, -0.309032798, -1, 3.34978104e-05, -5.31971455e-06, 5.31971455e-06, 0.309032798, 0.951051414),
					CFrame.new(-7692.85449, -26.0098934, -4668.61963, -3.36170197e-05, 0.951051414, -0.309032798, -1, -3.36170197e-05, 5.31971455e-06, -5.31971455e-06, 0.309032798, 0.951051414),
					CFrame.new(-7692.85449, -26.0098934, -4668.61963, -3.36170197e-05, 0.951051414, -0.309032798, -1, -3.36170197e-05, 5.31971455e-06, -5.31971455e-06, 0.309032798, 0.951051414),
					CFrame.new(4887.24609, -26.0098934, 1222.96826, -3.36170197e-05, 0.951051414, -0.309032798, -1, -3.36170197e-05, 5.31971455e-06, -5.31971455e-06, 0.309032798, 0.951051414)
				}
				
				for i, frame in pairs(frames) do
					if not scriptState.autoFarm then break end
					tweenToPosition(car, frame, scriptState.speed)
					task.wait(0.1)
				end
			end
		end)
	else
		if scriptState.activeTween then
			scriptState.activeTween:Cancel()
		end
		restoreWorkspaceObjects()
	end
end)

autoDeliverBtn.MouseButton1Click:Connect(function()
	scriptState.autoDeliver = not scriptState.autoDeliver
	autoDeliverBtn.Text = scriptState.autoDeliver and "Auto Deliver [ON]" or "Auto Deliver [OFF]"
	autoDeliverBtn.BackgroundColor3 = scriptState.autoDeliver and Color3.fromRGB(100, 200, 100) or Color3.fromRGB(50, 120, 200)
	
	if scriptState.autoDeliver then
		hideWorkspaceObjects()
		task.wait(0.5)
		
		task.spawn(function()
			while scriptState.autoDeliver do
				if not plr.Character or not plr.Character:FindFirstChild("Humanoid") then
					task.wait(1)
					continue
				end
				
				local chr = plr.Character
				local humanoid = chr:FindFirstChild("Humanoid")
				
				if not humanoid.SeatPart then
					task.wait(0.5)
					continue
				end
				
				local car = humanoid.SeatPart.Parent
				ensureGroundPart()
				
				if car:FindFirstChild("Body") and car.Body:FindFirstChild("#Weight") then
					car.PrimaryPart = car.Body["#Weight"]
				end
				
				local targetLocation = nil
				local maxDistance = math.huge
				
				for i, v in pairs(workspace:GetChildren()) do
					if v.Name == "" and v:FindFirstChild("Highlight") then
						local distance = (chr.PrimaryPart.Position - v.WorldPivot.Position).Magnitude
						if distance < maxDistance then
							maxDistance = distance
							targetLocation = v
						end
					end
				end
				
				if targetLocation and targetLocation.Parent then
					tweenToLocation(car, targetLocation, scriptState.speed)
					task.wait(0.5)
				elseif workspace:FindFirstChild("GiftPickup") then
					local giftPickup = workspace.GiftPickup
					car:PivotTo(CFrame.new(giftPickup.WorldPivot.Position + Vector3.new(0, 5, 0)))
					car.PrimaryPart.AssemblyLinearVelocity = Vector3.zero
					task.wait(1)
					
					if reachedMax(car) then
						task.wait(0.5)
					end
				else
					task.wait(1)
				end
			end
		end)
	else
		if scriptState.activeTween then
			scriptState.activeTween:Cancel()
		end
		restoreWorkspaceObjects()
	end
end)

minBtn.MouseButton1Click:Connect(function()
	contentFrame.Visible = not contentFrame.Visible
	minBtn.Text = contentFrame.Visible and "−" or "+"
end)

closeBtn.MouseButton1Click:Connect(function()
	scriptState.autoFarm = false
	scriptState.autoDeliver = false
	if scriptState.activeTween then
		scriptState.activeTween:Cancel()
	end
	gui:Destroy()
end)

warn("✓ Script loaded successfully on Delta executor")
